<%
// Corrected: Define the helper function to avoid potential global scope pollution 
// It's cleaner to define helpers outside the main HTML structure.

const formatDate = (dateString) => { 
    if (!dateString) return 'N/A';
    const date = new Date(dateString);
    // Using a simple format for clarity and robustness
    return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
};
%>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Sainma Kosam Admin</title>
    <style>
        .font-heading { font-family: 'Oswald', sans-serif; }
        body { background-color: #0A0A0A; font-family: 'Inter', sans-serif; }
        
        /* Table appearance */
        .table-header { background-color: #1A1A1A; }
        .table-row { background-color: #111111; transition: background-color 0.15s; }
        .table-row:nth-child(even) { background-color: #1A1A1A; }
        .table-row:hover { background-color: #222222; }
        
        /* Action button colors */
        .btn-white { background-color: #FFFFFF; color: #0A0A0A; }
        .btn-edit { background-color: #4A90E2; color: white; }
        .btn-delete { background-color: #E57373; color: white; }
        .error-box { background-color: #330000; border-color: #E57373; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-white">
    
    <header class="bg-black shadow-2xl border-b border-gray-900 px-6 py-4">
        <div class="flex justify-between items-center container mx-auto">
            <h1 class="text-3xl font-heading font-bold tracking-widest">
                ðŸŽ¬ SAINMA KOSAM ADMIN PAGE
            </h1>
            <nav class="flex space-x-4 items-center">
                <a href="/admin/reviews/new" class="px-4 py-2 text-sm font-bold btn-white rounded-full hover:bg-gray-300 transition shadow-md">
                    + NEW REVIEW
                </a>
                <a href="/auth/logout" class="text-gray-400 hover:text-red-500 transition text-sm py-1 border-b border-transparent hover:border-red-500">
                    LOGOUT
                </a>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-6 py-12">
        <h2 class="text-4xl font-heading font-extrabold mb-8">
            ALL TRANSMISSIONS (<%= reviews.length %>)
        </h2>

        <% if (error) { %>
            <div class="error-box border text-white p-4 rounded-lg mb-6"><%= error %></div>
        <% } %>

        <% if (reviews.length === 0) { %>
            <div class="text-center p-12 bg-[#1A1A1A] border border-gray-700 rounded-lg">
                <p class="text-xl text-gray-400">No chaos yet! Time to create the first review.</p>
                <a href="/admin/reviews/new" class="inline-block mt-6 px-6 py-3 text-lg font-bold btn-white rounded hover:bg-gray-300 transition">
                    START CRASHING REVIEWS
                </a>
            </div>
        <% } else { %>
            
            <div class="overflow-x-auto shadow-xl rounded-lg border border-gray-800">
                <table class="min-w-full divide-y divide-gray-800">
                    <thead class="table-header">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Title</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Author</th>
                            <th class="hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-800">
                        <% reviews.forEach(review => { %>
                            <tr class="table-row">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">
                                    <%= review.title %>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                                    <%= review.author %>
                                </td>
                                <td class="hidden md:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <%= formatDate(review.datePosted) %>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-center space-x-3">
                                    
                                    <a href="/admin/reviews/edit/<%= review._id %>" 
                                        class="btn-edit px-3 py-1 rounded text-xs font-semibold hover:opacity-80 transition">
                                        Edit
                                    </a>
                                    
                                    <form action="/admin/reviews/delete/<%= review._id %>?_method=DELETE" method="POST" class="inline">
                                        <button type="submit" 
                                                class="btn-delete px-3 py-1 rounded text-xs font-semibold hover:opacity-80 transition"
                                                onclick="return confirm('WARNING: Are you sure you want to permanently terminate this transmission?');">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

        <% } %>

    </main>

    <footer class="bg-black text-center py-4 text-gray-600 text-xs border-t border-gray-900">
        <p>SECURE CONSOLE. ACCESS LEVEL: ADMIN</p>
    </footer>

</body>
</html>